{{- if (eq .chezmoi.os "linux") -}}
#!/bin/bash

set -euo pipefail
set -x  # Enable debugging

{{   if (.headless) -}}
export HOMEBREW_PREFIX="$HOME/.homebrew"
{{   end -}}

packages=(
  fish
  starship 
  gh 
  thefuck 
  direnv 
  go-task/tap/go-task 
  zoxide 
  bat 
  lsd 
  viddy
  jq
  hidetatz/tap/kubecolor
  nano
  tldr
  chezmoi
)

# If Homebrew is not installed on the system, it will be installed here
if ! command -v brew &> /dev/null
then
  echo "\[\e[33m\]⚠ \[\e[0m\] Installing homebrew..."
  curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh | bash &> /dev/null
  (echo; echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"') >> {{ .chezmoi.homeDir }}/.bashrc
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
else
  echo "\[\e[32m\]✔ \[\e[0m\] Homebrew is already installed."
fi

# Update homebrew packages
echo "\[\e[33m\]⚠ \[\e[0m\] Initiating Homebrew update..."
brew update

echo "\[\e[33m\]⚠ \[\e[0m\] Installing packages..."
for package in "${packages[@]}"
do
  brew install "$package"
done

{{ end -}}
